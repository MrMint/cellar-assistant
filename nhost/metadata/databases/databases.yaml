- name: default
  kind: postgres
  configuration:
    connection_info:
      database_url:
        from_env: HASURA_GRAPHQL_DATABASE_URL
      isolation_level: read-committed
      pool_settings:
        connection_lifetime: 600
        idle_timeout: 180
        max_connections: 50
        retries: 1
      use_prepared_statements: true
  logical_models:
    - fields:
        - name: beer_id
          type:
            nullable: true
            scalar: uuid
        - name: wine_id
          type:
            nullable: true
            scalar: uuid
        - name: spirit_id
          type:
            nullable: true
            scalar: uuid
        - name: coffee_id
          type:
            nullable: true
            scalar: uuid
        - name: distance
          type:
            nullable: true
            scalar: float8
      name: image_search_result
      select_permissions:
        - permission:
            columns:
              - beer_id
              - wine_id
              - spirit_id
              - coffee_id
              - distance
            filter: {}
          role: user
  native_queries:
    - arguments:
        image:
          description: ""
          nullable: false
          type: text
      code: SELECT DISTINCT ON (beer_id, wine_id, spirit_id, coffee_id) *, vector <=> {{image}}::vector AS distance FROM public.item_image ORDER BY beer_id, wine_id, spirit_id, coffee_id, distance
      object_relationships:
        - name: beer
          using:
            column_mapping:
              beer_id: id
            insertion_order: null
            remote_table:
              name: beers
              schema: public
        - name: coffee
          using:
            column_mapping:
              coffee_id: id
            insertion_order: null
            remote_table:
              name: coffees
              schema: public
        - name: spirit
          using:
            column_mapping:
              spirit_id: id
            insertion_order: null
            remote_table:
              name: spirits
              schema: public
        - name: wine
          using:
            column_mapping:
              wine_id: id
            insertion_order: null
            remote_table:
              name: wines
              schema: public
      returns: image_search_result
      root_field_name: image_search
  tables: "!include default/tables/tables.yaml"
